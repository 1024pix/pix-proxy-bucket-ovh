log_format keyvalue
  'method=$request_method'
  ' path="$request_uri"'
  ' host=$host'
  ' request_id=$http_x_request_id'
  ' from="$remote_addr"'
  ' protocol=$scheme'
  ' status=$status'
  ' duration=${request_time}s'
  ' bytes=$bytes_sent'
  ' referer="$http_referer"'
  ' user_agent="$http_user_agent"';

access_log off;

server {
  # Scalingo Router
  set_real_ip_from 10.0.0.0/8;

  # Baleen https://support.baleen.cloud/hc/fr/articles/360016930920-Quelles-sont-les-plages-d-IP-de-Baleen-
  set_real_ip_from 185.179.148.0/22;
  set_real_ip_from 185.231.164.0/22;

  real_ip_header X-Forwarded-For;
  real_ip_recursive on;

  server_name localhost;

  listen <%= ENV['PORT'] %>;

  charset utf-8;
  access_log logs/access.log keyvalue;

  port_in_redirect off;
  
  location / {
      proxy_hide_header 'access-control-allow-origin';
      proxy_buffering off;

      add_header 'access-control-allow-origin' * always;

      proxy_pass <%= ENV["OVH_BUCKET_URL"] %>;
  }
}
